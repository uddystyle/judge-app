# Stripe料金プラン更新ガイド

このガイドでは、Stripeの料金設定を最新のプランに更新する手順を説明します。

## 更新する料金プラン

以下の料金プランをStripeに設定します：

| プラン | 月額 | 年額 |
|--------|------|------|
| Basic | ¥8,800 | ¥88,000 |
| Standard | ¥24,800 | ¥248,000 |
| Premium | ¥49,800 | ¥498,000 |

---

## 手順1: Stripeダッシュボードへのアクセス

1. [Stripe Dashboard](https://dashboard.stripe.com/)にログイン
2. 左側メニューから「商品カタログ」（Products）を選択

---

## 手順2: 既存の商品を確認

### オプションA: 既存の商品を更新する場合

既存の商品（Basic、Standard、Premium）がある場合：

1. 各商品名をクリック
2. 「料金を追加」ボタンをクリック
3. 新しい料金を作成（後述の手順3を参照）

**注意**: 既存の料金は削除せず、新しい料金を追加することを推奨します。既存のサブスクリプションに影響を与えないためです。

### オプションB: 新しい商品を作成する場合

既存の商品がない、または新規作成したい場合：

1. 「商品を追加」ボタンをクリック
2. 以下の手順で各プランを作成

---

## 手順3: Basicプランの作成・更新

### 3-1. 商品情報の入力

- **商品名**: `Basic`
- **説明** (任意): `ベーシックプラン - 小規模大会・認定会向け`
- **商品画像** (任意): 必要に応じて設定

### 3-2. 月額料金の作成

1. 「料金を追加」をクリック
2. 以下の設定を入力：
   - **料金モデル**: 標準の料金設定
   - **価格**: `8800`
   - **通貨**: `JPY (¥)`
   - **請求期間**: `月次` (Monthly)
   - **料金の説明** (任意): `Basic 月額プラン`

3. 「料金を作成」をクリック
4. **作成された Price ID をメモ** (例: `price_xxxxxxxxxxxxx`)

### 3-3. 年額料金の作成

1. 同じ商品ページで「料金を追加」をクリック
2. 以下の設定を入力：
   - **料金モデル**: 標準の料金設定
   - **価格**: `88000`
   - **通貨**: `JPY (¥)`
   - **請求期間**: `年次` (Yearly)
   - **料金の説明** (任意): `Basic 年額プラン`

3. 「料金を作成」をクリック
4. **作成された Price ID をメモ**

---

## 手順4: Standardプランの作成・更新

### 4-1. 商品情報の入力

- **商品名**: `Standard`
- **説明** (任意): `スタンダードプラン - 中規模大会向け`

### 4-2. 月額料金の作成

1. 「料金を追加」をクリック
2. 以下の設定を入力：
   - **価格**: `24800`
   - **通貨**: `JPY (¥)`
   - **請求期間**: `月次` (Monthly)
   - **料金の説明** (任意): `Standard 月額プラン`

3. **Price ID をメモ**

### 4-3. 年額料金の作成

1. 「料金を追加」をクリック
2. 以下の設定を入力：
   - **価格**: `248000`
   - **通貨**: `JPY (¥)`
   - **請求期間**: `年次` (Yearly)
   - **料金の説明** (任意): `Standard 年額プラン`

3. **Price ID をメモ**

---

## 手順5: Premiumプランの作成・更新

### 5-1. 商品情報の入力

- **商品名**: `Premium`
- **説明** (任意): `プレミアムプラン - 大規模大会・競技会向け`

### 5-2. 月額料金の作成

1. 「料金を追加」をクリック
2. 以下の設定を入力：
   - **価格**: `49800`
   - **通貨**: `JPY (¥)`
   - **請求期間**: `月次` (Monthly)
   - **料金の説明** (任意): `Premium 月額プラン`

3. **Price ID をメモ**

### 5-3. 年額料金の作成

1. 「料金を追加」をクリック
2. 以下の設定を入力：
   - **価格**: `498000`
   - **通貨**: `JPY (¥)`
   - **請求期間**: `年次` (Yearly)
   - **料金の説明** (任意): `Premium 年額プラン`

3. **Price ID をメモ**

---

## 手順6: アプリケーションへのPrice ID設定

Stripeで作成したPrice IDをアプリケーションに設定します。

### 6-1. 環境変数ファイルの確認

プロジェクトルートの `.env` ファイルを開きます。

### 6-2. Price IDの追加・更新

以下の環境変数を追加または更新します（実際のPrice IDに置き換えてください）：

```bash
# Basic プラン
PUBLIC_STRIPE_PRICE_BASIC_MONTHLY=price_xxxxxxxxxxxxx
PUBLIC_STRIPE_PRICE_BASIC_YEARLY=price_xxxxxxxxxxxxx

# Standard プラン
PUBLIC_STRIPE_PRICE_STANDARD_MONTHLY=price_xxxxxxxxxxxxx
PUBLIC_STRIPE_PRICE_STANDARD_YEARLY=price_xxxxxxxxxxxxx

# Premium プラン
PUBLIC_STRIPE_PRICE_PREMIUM_MONTHLY=price_xxxxxxxxxxxxx
PUBLIC_STRIPE_PRICE_PREMIUM_YEARLY=price_xxxxxxxxxxxxx
```

### 6-3. 本番環境への設定

本番環境（Vercel、Netlifyなど）にも同じ環境変数を設定してください。

**Vercelの場合**:
1. プロジェクトの Settings → Environment Variables
2. 各環境変数を追加
3. Production、Preview、Development 環境を選択

---

## 手順7: テストモードでの確認

**重要**: 本番環境で有効化する前に、必ずテストモードで動作確認を行ってください。

### 7-1. テストモードの有効化

1. Stripeダッシュボード左上の「テストモードで表示」トグルをONにする
2. テストモード用のPrice IDを作成（手順3-5を繰り返し）

### 7-2. テスト環境変数の設定

`.env.local` または `.env.development` ファイルを作成し、テスト用のPrice IDを設定：

```bash
PUBLIC_STRIPE_PRICE_BASIC_MONTHLY=price_test_xxxxxxxxxxxxx
PUBLIC_STRIPE_PRICE_BASIC_YEARLY=price_test_xxxxxxxxxxxxx
# ... 他のプランも同様
```

### 7-3. テストカードでの確認

Stripeのテストカード番号を使用して、サブスクリプション購入をテスト：

- **成功するカード**: `4242 4242 4242 4242`
- **有効期限**: 未来の任意の日付（例: 12/34）
- **CVC**: 任意の3桁（例: 123）

各プラン（月額・年額）で購入フローが正常に動作することを確認してください。

---

## 手順8: 本番環境での有効化

テストが完了したら、本番環境で有効化します。

### 8-1. 本番モードでのPrice ID作成

1. Stripeダッシュボードで「本番モードで表示」に切り替え
2. 手順3-5を繰り返し、本番用のPrice IDを作成

### 8-2. 本番環境変数の更新

本番環境の環境変数に、本番用のPrice IDを設定します。

### 8-3. デプロイと確認

1. アプリケーションをデプロイ
2. 本番環境で料金表示が正しいことを確認
3. 実際の決済フローをテスト（少額での確認を推奨）

---

## 手順9: 既存顧客の対応（該当する場合）

既存のサブスクリプション顧客がいる場合の対応：

### オプション1: 既存顧客はそのまま継続

- 既存の料金プランを削除せず残す
- 新規顧客のみ新料金を適用
- 既存顧客には別途連絡して、プラン変更を案内

### オプション2: 既存顧客も新料金に移行

1. 顧客に事前通知（料金変更の告知）
2. Stripe APIまたはダッシュボードで各サブスクリプションを更新
3. プロレーション（日割り計算）の設定を確認

**注意**: 料金変更は顧客への影響が大きいため、十分な事前通知と同意取得が必要です。

---

## トラブルシューティング

### 問題1: Price IDが見つからない

**解決策**:
- Stripeダッシュボードで商品→料金の詳細ページを確認
- Price IDは `price_` で始まる文字列
- テストモードと本番モードで異なるIDになることに注意

### 問題2: 環境変数が反映されない

**解決策**:
- 開発サーバーを再起動（`npm run dev` を再実行）
- `.env` ファイルが `.gitignore` に含まれていることを確認
- `PUBLIC_` プレフィックスが付いていることを確認（SvelteKitで必要）

### 問題3: 決済が失敗する

**解決策**:
- ブラウザのコンソールでエラーメッセージを確認
- Stripe APIキーが正しく設定されているか確認
- Stripe Webhookが正しく設定されているか確認

---

## チェックリスト

完了したら、以下の項目にチェックを入れてください：

- [ ] Basicプランの月額料金（¥8,800）を作成
- [ ] Basicプランの年額料金（¥88,000）を作成
- [ ] Standardプランの月額料金（¥24,800）を作成
- [ ] Standardプランの年額料金（¥248,000）を作成
- [ ] Premiumプランの月額料金（¥49,800）を作成
- [ ] Premiumプランの年額料金（¥498,000）を作成
- [ ] 全てのPrice IDをメモした
- [ ] `.env` ファイルに環境変数を設定
- [ ] テストモードで動作確認
- [ ] 本番環境の環境変数を更新
- [ ] 本番環境にデプロイ
- [ ] 本番環境で料金表示を確認
- [ ] 決済フローをテスト

---

## 参考リンク

- [Stripe Products and Prices](https://stripe.com/docs/products-prices/overview)
- [Stripe Billing](https://stripe.com/docs/billing)
- [Stripe Testing](https://stripe.com/docs/testing)

---

## サポート

問題が解決しない場合は、以下を確認してください：

1. [Stripe公式ドキュメント](https://stripe.com/docs)
2. [Stripeサポート](https://support.stripe.com/)
3. アプリケーションの開発チーム

---

**最終更新日**: 2025年11月8日
